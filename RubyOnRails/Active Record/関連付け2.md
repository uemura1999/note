##  アソシエーションとは？
- モデル間の関連付けに使われる概念
  - 具体例で考えてみよう
    - Aさんが一人で使う記事投稿機能のみのブログを作成
      - Articleモデルのみ実装
    - Bさんが勝手に自分の投稿をし始める
      - どれが誰の投稿かわからないため、ユーザーログイン機能を実装
        - Userモデルを実装
    - どれが誰の投稿なのかを関連付けるものがアソシエーション
      - モデル同士の親子関係がどうなっているがとても大事！
- モデル同士の親子関係とは？
  - User has many Articles
    - User A,B はたくさんのArticleを持っている
  - Article belongs to User
    - Articleは、誰か一人のUserに属している
  - Userが親、Articleが子
    - 1対多の関係または1:nの関係

##  データベース設計
- データベース設計とは？
  - 情報システムにおいて、どの情報をDBに格納すべきかを検討し、その「格納すべき情報」を「どのような形で保持するか？」を設計すること
    - 情報システム：Twitter
    - 格納すべき情報：ユーザー(email, password), ツイート
    - どのような形で保持：emailは文字列, その識別idは整数型
- データベース設計における４つの概念
  - エンティティ
    - 管理すべき情報
      - User,Tweet...
  - 関連（リレーション）
    - 結びつきのあるエンティティ同士をリンクさせるもの
      - UserとArticle, UserとTweet
  - 属性（プロパティ）
    - エンティティに従属する項目
      - エンティティを１つに定めた時に、一緒に分かる情報
        - Userにはemail, passwordがある
  - 関連の多重度
    - 片方から他方を見た時に、相手が１つか複数なのか明らかにすること
    - 相手の数を明らかにすることが、多重度を決定するということ
      - Userから見るとArticleは複数
      - Articleから見るとUserは１つ
- ER図とIE記法
  - ER図
    - DB設計で使う設計手法（お絵かきの方法）
      - ER図なしにはDBを構築できない
  - IE記法
    - ER図を描くための記法
      - 関連(リレーション)、関連の多重度の２つを決める
    - ３つの記号
      - ◯：0
      - |：1
      - 鳥の足：多

##  UserとArticleのの実装（1対多の関係）
- １つのUserはたくさんのArticleを持っている
  - Userモデル
    - id, name, encrypted_password
  - Articleモデル
    - id, body
  - User 鳥の足 Article
    - ArticleがどのUserに所属しているかの情報がない
      - foreign_keyで指定
  - foreign_keyとは？
    - 親のid(Priamry Key)を保存するカラム
      - Primary Key(主キー)：データを識別するためのid
        - Railsではidというカラム名でテーブル作成時に標準搭載
    - Articleモデルにuser_idカラムを追加
      - 命名規則：親のモデル名_id
  - has_many
    - UserはたくさんのArticleを持っているので、Userモデルに記述
      - has_many :articles(複数形)
  - belongs_to
    - Articleは一つのUserに所属しているので、Articleモデルに記述
      - belongs_to :user(単数形)
- １対多のまとめ
  - 親子関係を考え、子供に親のid(foreign_key)が入るカラムを追加
  - 親側モデルに has_many :子供のモデル名の複数形
  - 子供側モデルに belongs_to :親のモデル名の単数形

##  Favoriteの実装（多対多の関係）
- UserもArticleもたくさん持っている関係を多対多(M:N)の関係
  - Favoriteは、UserがArticleに対してつける印
    - User：たくさんのArticleをお気に入りすることができる
    - Article：たくさんのUserにお気に入りされる
- 多対多(M:N)を設計しよう
  - お互いがお互いのforeign_keyを知らなくてはいけない
    - favorite_user_idにファボしたユーザーのidが入る
      - favorite_user_id = [1,2]
  - 複数のUserのファボが増えると、配列に追加（非常に面倒...）
- お互いのidだけを保存するテーブル(中間テーブル)が必要！
  - 中間テーブルに保存されるarticle_id, user_idで判断する
    - あるArticleについたお気に入り数を見たい
      - article_idと同じレコードに保存しているuser_idを数える
    - あるUserのお気に入りしたArticleを見たい
      - user_idと同じレコードに保存しているarticle_idから検索
- 中間テーブルを使ってER図の作成
  - UserとArticleの間にFavoriteテーブルを追加
    - 中間テーブルはたくさん持たれる側(どちらもbelongs_to)



- 参考資料
  - 【初心者向け】丁寧すぎるRails『アソシエーション』チュートリアル【幾ら何でも】【完璧にわかる】
    - https://qiita.com/kazukimatsumoto/items/14bdff681ec5ddac26d1
##  オブジェクトのライフサイクル
- オブジェクトライフサイクルとは？
  - オブジェクトの作成・更新・削除などのライフサイクル
    - イベントの「前」「後」「前後」のいずれかにフック

##  コールバックの概要
- コールバックとは？
  - オブジェクトのライフサイクルの特定の瞬間に呼び出されるメソッド
  - オブジェクトの状態が切り替わる「前」または「後」にロジックをトリガする
- コールバックの登録方法
  - 普通のメソッドと同じように定義する
    - privateメソッドとして宣言するのが一般的

##  利用可能なコールバック
- オブジェクトの生成
  - before_validation（バリデーション前に実行）
  - after_validation（バリデーション後に実行）
  - before_save（保存前に実行）
  - around_save（保存前後に実行）
  - before_create（作成前に実行）
  - around_create（作成前後に実行）
  - after_create（作成後に実行）
  - after_save（保存後に実行）
  - after_commit（コミット後に実行）
  - after_rollback（ロールバック後に実行）
    - ロールバック：マイグレーション後に問題があり前の状態まで戻すこと
- オブジェクトの更新
  - before_validation
  - after_validation
  - before_save
  - around_save
  - before_update（更新前に実行）
  - around_update（更新前後に実行）
  - after_update（更新後に実行）
  - after_save
  - after_commit
  - after_rollback
- オブジェクトの削除
  - before_destroy（削除前に実行）
  - around_destroy（削除前後に実行）
  - after_destroy（削除後に実行）
  - after_commit
  - after_rollback
- after_initializeとafter_find
  - after_initialize
    - オブジェクトがインスタンス化されるたびに実行される
  - after_find
    - DBからレコードを１件読み込むたびに実行される
- after_touch
  - touchメソッドを呼び出したときに実行される
    - touchメソッド：updated_atカラムを更新するメソッド

##  コールバックの実行
- コールバックをトリガするメソッド
  - create(!), save(!), update(!), destroy(!)...
    - 詳細は、4.コールバックの実行を参照
- コールバックをスキップするメソッド
  - decrement!, delete, insert(!),upsert...
    - 詳細は、5.コールバックをスキップするを参照
- コールバックの停止
  - コールバックの１つで例外が発生すると、実行チェーン全体が停止してロールバックが発行
  - チェーンを意図的に停止するには
    - throw(:abort)

##  リレーションシップのコールバック
- リレーションシップのコールバックとは？
  - 関連するオブジェクトの作成・更新・削除のタイミングで実行されるコールバック
    - 例：商品を削除したら、その商品に関連付けられているレビューも削除する

##  関連付けのコールバック
- has_manyやbelongs_toで関連付けを定義すると、関連付けのコールバックが利用可能になる
- 関連付けコールバック
  - before_add
    - 関連付けを追加する前に実行される
  - after_add
    - 関連付けを追加した後に実行される
  - before_remove
    - 関連付けを削除する前に実行される
  - after_remove
    - 関連付けを削除した後に実行される

##  条件付きコールバック
- 指定された述語の条件を満たす場合に実行されるコールバック
  - ifオプション
    - if: :条件メソッド名
      - 条件メソッド名がtrueを返す場合に実行される
      - Procオブジェクトを渡すこともできる
  - unlessオプション
    - unless: :条件メソッド名
      - 条件メソッド名がfalseを返す場合に実行される
      - Procオブジェクトを渡すこともできる
  - ifとunlessの両方を指定することもできる
    - if: :条件メソッド名, unless: :条件メソッド名
      - 両方の条件を満たす場合に実行される

##  コールバッククラス
- コールバックメソッドをカプセル化したクラスを作成
  - 他のモデルでも使い回したい場合に便利
- コールバッククラス内でインスタンスメソッドを定義する
  - コールバックメソッドをカプセル化したクラスを作成
  - インスタンスメソッドとしてコールバックメソッドを定義
    - オブジェクトを新しくインスタンス化する必要がある
- コールバックをクラスメソッドとして利用する
  - モデル内でオブジェクトをインスタンス化する必要がない

##  トランザクションのコールバック
- DBのトランザクションが完了したときに実行されるコールバック
  - after_saveとの違い
    - DBの変更のコミット又はロールバックが完了するまでトリガされない
  - after_commit
    - トランザクションが完了したときに実行される
      - after_create_commit, after_update_commit, after_destroy_commit
  - after_rollback
    - トランザクションがロールバックされたときに実行される
  - after_save_commit
    - 作成と更新の両方でafter_commitを使う場合に便利
- トランザクショナルなコールバックの順序
  - after_(after_commitやafter_rollback)を複数定義すると逆順で実行される可能性がある